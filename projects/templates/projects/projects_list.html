{% extends "base.html" %}
{% load catalog_extras %}
{% block title %}Projects ‚Ä¢ Perfect Home Studio{% endblock %}

{% block content %}
<section class="page">
  <div class="container">
    <div class="page-head">
      <div>
        <h1>Projects</h1>
        <p class="muted">Real solutions and inspiration for your next big project.</p>
      </div>

      {% if user.is_staff %}
        <div class="page-actions">
          <a class="btn btn-primary" href="{% url 'projects:project_create' %}">Create Project</a>
        </div>
      {% endif %}
    </div>

    <div class="pillbar-wrapper">
      <div style="display: flex; gap: 10px; align-items: center;">
        <div class="pillbar">
          <a class="pill {% if not current_section %}is-active{% endif %}" href="?{% param_replace section=None %}">All</a>
          <a class="pill {% if current_section == 'bath' %}is-active{% endif %}" href="?{% param_replace section='bath' %}">Bath</a>
          <a class="pill {% if current_section == 'kitchen' %}is-active{% endif %}" href="?{% param_replace section='kitchen' %}">Kitchen</a>
        </div>

        <form method="get" class="inline-search">
          <input type="text" name="q" value="{{ request.GET.q|default:'' }}"
                 placeholder="Search projects..." class="inline-search-input">
          <button type="submit" class="inline-search-button">üîç</button>
          {% for key, value in request.GET.items %}
            {% if key != 'q' and key != 'page' %}
              <input type="hidden" name="{{ key }}" value="{{ value }}">
            {% endif %}
          {% endfor %}
        </form>
      </div>

      <div class="sort-controls">
        <span class="muted" style="font-size: 13px; font-weight: 800;">Sort by:</span>
        <select class="sort-select" onchange="location.href='?{% param_replace sort='REPLACE_ME' %}'.replace('REPLACE_ME', this.value)">
          <option value="newest" {% if current_sort == 'newest' %}selected{% endif %}>Newest</option>
          <option value="oldest" {% if current_sort == 'oldest' %}selected{% endif %}>Oldest</option>
          <option value="title" {% if current_sort == 'title' %}selected{% endif %}>Title: A-Z</option>
          <option value="-title" {% if current_sort == '-title' %}selected{% endif %}>Title: Z-A</option>
        </select>
      </div>
    </div>

    <div class="grid grid-3">
      {% for p in projects %}
        <a class="card card-link" href="{% url 'projects:project_detail' p.slug %}">
          <div class="card-media">
            {% if p.cover_image %}
              <img src="{{ p.cover_image.url }}" alt="{{ p.title }}">
            {% else %}
              <div class="media-placeholder">Project</div>
            {% endif %}
          </div>
          <div class="card-body">
            <div class="card-title">{{ p.title }}</div>
            <div class="muted">{{ p.get_section_display }}</div>
            <div class="total-cost-highlight">Total cost: {{ p.total_price|currency }}</div>
            {% if p.short_description %}
              <div class="muted clamp-2">{{ p.short_description }}</div>
            {% endif %}
          </div>
        </a>
      {% empty %}
        <div class="empty">
          <h3>No projects yet</h3>
          <p class="muted">Add a few projects from the admin panel.</p>
        </div>
      {% endfor %}
    </div>

    {% include "partials/_pager.html" %}
  </div>
</section>
{% endblock %}